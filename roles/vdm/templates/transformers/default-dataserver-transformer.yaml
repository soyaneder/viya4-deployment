apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-platform-postgres-dataserver-transformer
patch: |-
  - op: add
    path: "/metadata/annotations/sas.com~1database-server-location"
    value: external # Identifies that database server is external

  - op: replace
    path: /spec/databases/0/name
    value: SharedServices

  - op: replace
    path: /spec/users/0/credentials/input
    value:
      secretRef:
        name: default-platform-postgres-user
      usernameKey: username # For internal use, do not modify
      passwordKey: password # For internal use, do not modify

  - op: replace
    path: /spec/registrations/0/host
    value: scotia-peru-default-flexpsql.postgres.database.azure.com

  - op: replace
    path: /spec/registrations/0/port
    value: 5432

  - op: replace
    path: /spec/ssl
    value: true
target:
  group: webinfdsvr.sas.com
  kind: DataServer
  version: v1beta1
  name: sas-platform-postgres
