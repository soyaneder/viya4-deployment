<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <link rel="stylesheet" type="text/css" href="sas.css"/>
        <title>Configure SAS Model Publish Service to Add Service Account</title>
    </head>
    <body>
        <h1 id="139729115042480configure-sas-model-publish-service-to-add-service-account">Configure SAS Model Publish Service to Add Service Account</h1>
<p><strong>Note:</strong> This guide applies <strong>only</strong> to SAS Viya platform
deployments in a <strong>Red Hat OpenShift</strong> environment.</p>
<p>In OpenShift, a security context constraint (SCC) is required for publishing objects
(models or decisions), as well as updating and validating published objects.
These actions create jobs within the cluster that
must run as user 1001 (sas), must have permission to mount volumes containing
container registry credentials, and must have access existing image pull secrets.
This README explains how to apply the <code>sas-model-publish</code> SCC to the appropriate
service accounts:</p>
<ul>
<li>Apply the SCC to the <code>sas-model-publish-buildkit</code> and
  <code>sas-decisions-runtime-builder-buildkit</code> service accounts
  for publishing and updating.</li>
<li>Apply the SCC to the <code>default</code> service account only if you expect
  validation to be run within that specific OpenShift cluster and namespace.
  For example, if the SAS Viya platform is deployed on AWS but the validation
  jobs are executed in an OpenShift cluster, the <code>sas-model-publish</code> SCC must
  be applied to the <code>default</code> service account in the namespace where validation runs.
  This ensures those jobs have the necessary permissions in that environment.
  If validation is not executed in OpenShift, applying the SCC to the <code>default</code>
  service account is not required.</li>
</ul>
<h2 id="139729115042480prerequisites">Prerequisites</h2>
<h3 id="139729115042480granting-scc-on-an-openshift-cluster">Granting SCC on an OpenShift Cluster</h3>
<p>The <code>/$deploy/sas-bases/overlays/sas-model-publish/service-account</code> directory
contains a file to grant SCC to sas-model-publish and
sas-decisions-runtime-builder jobs.</p>
<p>A Kubernetes cluster administrator should add this SCC
to their OpenShift cluster prior to deploying the SAS Viya platform.
Use each of the following commands:</p>
<pre class="highlight"><code class="language-yaml">kubectl apply -f sas-model-publish-scc.yaml</code></pre>

<h3 id="139729115042480bind-the-scc-to-a-service-account">Bind the SCC to a Service Account</h3>
<p>After the SCC has been applied, you must link it to the appropriate service
accounts that will use it. Use the following commands:</p>
<pre class="highlight"><code class="language-yaml">oc -n {{ NAME-OF-VALIDATION-NAMESPACE }} adm policy add-scc-to-user sas-model-publish -z
default

oc -n {{ NAME-OF-VIYA-NAMESPACE }} adm policy add-scc-to-user sas-model-publish -z
sas-model-publish-buildkit

oc -n {{ NAME-OF-VIYA-NAMESPACE }} adm policy add-scc-to-user sas-model-publish -z
sas-decisions-runtime-builder-buildkit</code></pre>

<h2 id="139729115042480installation">Installation</h2>
<p>Complete the deployment steps to apply the new settings. See
<a href="http://documentation.sas.com/?cdcId=itopscdc&amp;cdcVersion=default&amp;docsetId=dplyml0phy0dkr&amp;docsetTarget=p127f6y30iimr6n17x2xe9vlt54q.htm">Deploy the Software</a>
in <em>SAS Viya Platform: Deployment Guide</em>.</p>
<p><strong>Note:</strong> This overlay can be applied during the initial deployment of the
SAS Viya platform or after the deployment of the SAS Viya platform.</p>
<ul>
<li>If you are applying the overlay during the initial deployment of the SAS
  Viya platform, complete all the tasks in the README files that you want to
  use, then run <code>kustomize build</code> to create and apply the manifests.</li>
<li>If the overlay is applied after the initial deployment of the SAS Viya
  platform, run <code>kustomize build</code> to create and apply the manifests.</li>
</ul>
<h2 id="139729115042480post-installation-tasks">Post-Installation Tasks</h2>
<ol>
<li>
<p>Run the following command to verify whether the overlay has been applied:</p>
<pre class="highlight"><code class="language-sh">kubectl -n &lt;name-of-namespace&gt; get rolebindings -o wide | grep sas-model-publish</code></pre>

</li>
<li>
<p>Verify that the sas-model-publish SCC is bound to sas-model-publish-buildkit
   and sas-decisions-runtime-builder-buildkit service accounts.</p>
</li>
</ol>
    </body>
</html>