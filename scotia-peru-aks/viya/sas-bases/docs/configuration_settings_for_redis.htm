<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <link rel="stylesheet" type="text/css" href="sas.css"/>
        <title>Configuration Settings for Redis</title>
    </head>
    <body>
        <h1 id="139729115396848configuration-settings-for-redis">Configuration Settings for Redis</h1>
<h2 id="139729115396848overview">Overview</h2>
<p>Redis is used as a distributed cache for SAS Viya platform services. This README
file describes the settings available for deploying Redis.</p>
<h2 id="139729115396848installation">Installation</h2>
<p>The configuration files are located at <code>$deploy/sas-bases/examples/redis/server</code>.
The following sections describe the configuration files and how to use them in
your SAS Viya platform deployment.</p>
<h3 id="139729115396848change-memory-resources">Change Memory Resources</h3>
<p>The <code>redis-modify-memory.yaml</code> transformer file allows you to change the memory
resources for Redis nodes. The default required value is 90Mi, and the default
limit is 500Mi. The Redis &lsquo;maxmemory&rsquo; setting is set to 90% of the container
memory limit.</p>
<ol>
<li>
<p>Copy the <code>$deploy/sas-bases/examples/redis/server/redis-modify-memory.yaml</code> file to <code>site-config/redis/server/redis-modify-memory.yaml</code>.</p>
</li>
<li>
<p>The variables in the copied file are set
off by curly braces and spaces, such as {{ MEMORY-LIMIT }}. Replace
each variable string, including the braces, with the values you want to use.
If you want to use the default for a variable, make no changes to that variable.</p>
</li>
<li>
<p>After you have edited the file, add a reference to it in the transformers block
of the base kustomization.yaml file (<code>$deploy/kustomization.yaml</code>). Here is an
example:</p>
<pre class="highlight"><code class="language-yaml">transformers:
...
- site-config/redis/server/redis-modify-memory.yaml</code></pre>

</li>
</ol>
<h3 id="139729115396848modify-persistentvolumeclaim-or-storageclass">Modify PersistentVolumeClaim or StorageClass</h3>
<p>The redis-modify-pvc.yaml transformer file allows you to modify the
PersistentVolumeClaim (PVC) size or the StorageClass for nodes.</p>
<p><strong>Note:</strong> For existing deployments, you must delete the Redis StatefulSet and PVCs
before applying the PVC size change. This will result in the loss of data cached
by services. Begin at step 4 if you are not updating an existing deployment.</p>
<ol>
<li>
<p>Delete the Redis StatefulSet.</p>
<pre class="highlight"><code class="language-bash">kubectl -n &lt;name-of-namespace&gt; delete statefulset sas-redis-server</code></pre>

</li>
<li>
<p>Wait for all of the pods to terminate before deleting the PVCs. You can check the
status of the Redis pods with the following command:</p>
<pre class="highlight"><code class="language-bash">kubectl -n &lt;name-of-namespace&gt; get pods -l app.kubernetes.io/name=sas-redis-server</code></pre>

</li>
<li>
<p>When no pods are listed as output for the command in step 2, delete the PVCs:</p>
<pre class="highlight"><code class="language-bash">kubectl -n &lt;name-of-namespace&gt; delete pvc -l app.kubernetes.io/name=sas-redis-server</code></pre>

</li>
<li>
<p>Copy the <code>$deploy/sas-bases/examples/redis/server/redis-modify-pvc.yaml</code> file to <code>site-config/redis/server/redis-modify-pvc.yaml</code>.</p>
</li>
<li>
<p>The variables in the copied file are set
off by curly braces and spaces, such as {{ PVC_SIZE }} and {{ STORAGE_CLASS }}.
Replace each variable string, including the braces, with the values you want to use.
If you want to use the default for a variable, make no changes to that variable.</p>
</li>
<li>
<p>After you have edited the file, add a reference to it in the transformers block
of the base kustomization.yaml file (<code>$deploy/kustomization.yaml</code>). Here is an
example:</p>
<pre class="highlight"><code class="language-yaml">transformers:
...
- site-config/redis/server/redis-modify-pvc.yaml</code></pre>

</li>
</ol>
    </body>
</html>