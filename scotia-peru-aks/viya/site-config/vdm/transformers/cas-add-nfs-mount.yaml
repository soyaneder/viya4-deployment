# Add additional mounts needed to conform to deployment pattern
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: cas-add-nfs-mount
patch: |-
  - op: add
    path: /spec/controllerTemplate/spec/volumes/-
    value:
      name: cas-admin
  - op: add
    path: /spec/controllerTemplate/spec/volumes/-
    value:
      name: nfs-data
      nfs:
        server: 192.168.3.4
        path: /scotia-peru-export/viya/data
  - op: add
    path: /spec/controllerTemplate/spec/volumes/-
    value:
      name: nfs-homes
      nfs:
        server: 192.168.3.4
        path: /scotia-peru-export/viya/homes
  - op: add
    path: /spec/controllerTemplate/spec/containers/0/volumeMounts/-
    value:
      name: cas-admin
      mountPath: /cas/cas-admin
      readOnly: true
  - op: add
    path: /spec/controllerTemplate/spec/containers/0/volumeMounts/-
    value:
      name: nfs-data
      mountPath: /mnt/viya-share/data
  - op: add
    path: /spec/controllerTemplate/spec/containers/0/volumeMounts/-
    value:
      name: nfs-homes
      mountPath: /scotia-peru-export/viya/homes
target:
  group: viya.sas.com
  kind: CASDeployment
  name: .*
  version: v1alpha1
